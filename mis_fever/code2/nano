#!/bin/bash
#SBATCH --job-name=roberta_base_ratio_1_1_40
#SBATCH --partition=gpu
#SBATCH --gres=gpu:a100:1
#SBATCH --cpus-per-task=8
#SBATCH --mem=32G
#SBATCH --time=48:00:00
#SBATCH --chdir=/users/acs24jw/nli_project/mis_fever
#SBATCH --output=/users/acs24jw/nli_project/mis_fever/logs/roberta_base_ratio_1_1_40_%j.out
#SBATCH --error=/users/acs24jw/nli_project/mis_fever/logs/roberta_base_ratio_1_1_40_%j.err

mkdir -p logs outputs_roberta_base_ratio_1_1_40

# 环境
source ~/.bashrc
conda activate nli_env
export TRANSFORMERS_OFFLINE=1
export HF_DATASETS_OFFLINE=1
export TOKENIZERS_PARALLELISM=false

# 路径
PY="/users/acs24jw/nli_project/mis_fever/code2/bert_real_runner3.py"
VAL_PATH="/users/acs24jw/nli_project/mis_fever/data/dev_f.jsonl"
TEST_PATH="/users/acs24jw/nli_project/mis_fever/data/test_f.jsonl"
INIT_DIR="/users/acs24jw/nli_project/mis_fever/data/fever_2000/ratio_1_1_40"
MODEL_DIR="/mnt/parscratch/users/acs24jw/models/roberta-base_model"
OUTPUT_ROOT="/users/acs24jw/nli_project/mis_fever/outputs_roberta_base_ratio_1_1_40"

# 训练参数
ENSEMBLE=5
ROUNDS=4
BUDGET=200
BATCH=32
MAXLEN=256
EPOCHS=3
PATIENCE=2
LR=2e-5
SEED=42

echo "[INFO] RoBERTa-base + VaGeRy + ALVIN + controlled-optimal on ratio_1_1_40"
python "$PY" \
  --init_dir "$INIT_DIR" \
  --val_path "$VAL_PATH" \
  --test_path "$TEST_PATH" \
  --model_dir "$MODEL_DIR" \
  --output_root "$OUTPUT_ROOT" \
  --strategies alvin \
  --modes controlled-optimal \
  --ensemble_size $ENSEMBLE \
  --rounds $ROUNDS \
  --budget $BUDGET \
  --batch_size $BATCH \
  --max_len $MAXLEN \
  --epochs $EPOCHS \
  --patience $PATIENCE \
  --lr $LR \
  --seed $SEED \
  --gen_mix 0

